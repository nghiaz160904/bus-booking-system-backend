networks:
  # 'docker-compose up' will create this as a 'bridge' network
  booking-network:

services:
  # --- 1. Configuration Server ---
  config-server:
    hostname: config-server
    # 'build' tells docker-compose to build this image
    build:
      context: ./config-server
      args:
        # This path is from your Dockerfile
        JAR_FILE: config-server-0.0.1-SNAPSHOT.jar
    image: com.booking/config-server:0.0.1-SNAPSHOT
    ports:
      - "8888:8888"
    environment:
      # This reads the PAT from your .env file
      - GITHUB_PAT=${GITHUB_PAT}
    networks:
      - booking-network

  service-registry:
    hostname: service-registry
    build:
      context: ./service-registry
      args:
        JAR_FILE: service-registry-0.0.1-SNAPSHOT.jar
    image: com.booking/service-registry:0.0.1-SNAPSHOT
    ports:
      - "8081:8081"
      # Add all other required env variables from your .env file
    depends_on:
      - config-server
    networks:
      - booking-network

  # --- 3. User Service ---
  user-service:
    hostname: user-service
    build:
      context: ./services/user-service
      args:
        JAR_FILE: user-service-0.0.1-SNAPSHOT.jar
    image: com.booking/user-service:0.0.1-SNAPSHOT
    ports:
      - "8082:8082"
      # Add all other required env variables from your .env file
    depends_on:
      - config-server 
      - service-registry
    networks:
      - booking-network

  # --- 4. API Gateway ---
  api-gateway:
    hostname: api-gateway
    build:
      context: ./api-gateway
      args:
        JAR_FILE: api-gateway-0.0.1-SNAPSHOT.jar
    image: com.booking/api-gateway:0.0.1-SNAPSHOT
    ports:
      - "8080:8080"
    depends_on:
      - config-server
      - user-service 
      - service-registry
    environment:
      # This is the fast way to set debug logging.
      - LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_CLOUD_GATEWAY=DEBUG
      - LOGGING_LEVEL_REACTOR_NETTY_HTTP_CLIENT=DEBUG
      # This flag enables the ability to change logging levels at runtime (safe to include)
      - SPRING_APPLICATION_ADMIN_ENABLED=true
    networks:
      - booking-network